name: aws-ec2
description: Starts AWS EC2 spot instance with github actions runner agent in it to process one job

inputs:
  RUNNER_REG_TOKEN:
    description: Github Actions Runner registration token
    required: true
  AWS_ACCESS_KEY:
    description: AWS access id
    required: true
  AWS_SECRET_KEY:
    description: AWS access secret key
    required: true
  aws-region:
    description: AWS EC2 region
    required: false
    default: "us-east-2" # Ohio
  aws-ami:
    description: AWS AMI id
    required: false
    default: "ami-02f3416038bdb17fb" # Canonical, Ubuntu, 22.04 LTS, amd64 jammy image build on 2022-06-09
    # ami-06bf0a3f89fe08f0a: Amazon Linux 2 AMI with NVIDIA TESLA GPU Driver
    # ami-0bb1072e787242eb6: Amazon Linux 2 AMI with AMD Radeon Pro Driver
  aws-ec2-type:
    description: AWS EC2 instance type
    required: false
    default: "t2.micro"
    # g4dn.xlarge: 1 NVIDIA T4 GPU, 4 CPU, 16 GB RAM 
    # g4ad.xlarge: 1 AMD Radeon Pro V520 GPU, 4 CPU, 16 GB RAM
  aws-ec2-timebomb:
    description: AWS EC2 instance maximum live time
    required: false
    default: 1h
 
outputs:
  label:
    description: Name of the unique label assigned to the runner used as 'runs-on' property for the following jobs
    
runs:
  using: node12
  main: ./aws-ec2.js
